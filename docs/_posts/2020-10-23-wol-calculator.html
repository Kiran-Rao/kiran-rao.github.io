---
layout: post
title: 'Calendar of Your Life Calculator'
date: 2021-10-23
author: Kiran Rao
---

<p>
  I bought a
  <a
    href="https://shop-us.kurzgesagt.org/collections/posters/products/lifespan-calendar-poster"
    target="_blank"
    rel="noopener">Calendar of Your Life</a>
  poster from Kurzgesagt. Partly to support the
  <a href="https://www.youtube.com/c/inanutshell" target="_blank" rel="noopener">Youtube Channel</a> and partly to
  remind me that life is short.
</p>
<p>
  I started filling out each bubble. One at a time. In black. It was so... boring. Not just the process of filling
  bubles, but the end result.
</p>

<p>
  Instead, I thought it would be cool break my life into segments. But I needed a way to translate specific calendar
  dates into their corresponding bubbles. So I created this tool to help.
</p>

<div class="highlight">
  <p>Birth Date: <input id="dob" onblur="getValuesAndUpdateAll()" /></p>
  <div id="event_rows"></div>
</div>

<script src="{{ "/static/moment.js" | prepend: site.baseurl }}"></script>
<script>
  var dobInput = document.getElementById('dob');
  var eventRows = document.getElementById('event_rows');

  // Const
  var DOB_STORAGE_KEY = 'dob';
  var EVENT_STORAGE_KEY = 'event_'
  var USE_ONE_INDEX = true;

  // Globals
  var num_rows = 0;

  function createRow(rowNumber) {
    eventRows.insertAdjacentHTML('beforeend', '<p>Event: <input class="event_input" onblur="blurListener(' + rowNumber + ')" /> <span class="event_res"></span></p>');
  }

  function getValuesAndUpdateAll() {
    dobString = dobInput.value
    if (!moment(dobString).isValid()) {
      alert('TODO: Make this more nice');
      return;
    }

    localStorage.setItem(DOB_STORAGE_KEY, dobString);


    for (var i = 0; i < eventRows.children.length; i++) {
        updateRowAtIndex(i);
    }
  }

  function blurListener(index) {
    updateRowAtIndex(index);

    if (index >= num_rows - 1) {
      createRow(index + 1)
      num_rows = eventRows.childElementCount;
    }
  }

  function updateRowAtIndex(index) {
    child = eventRows.children.item(index);

    var eventInput = child.getElementsByClassName('event_input').item(0);
    var eventRes = child.getElementsByClassName('event_res').item(0);

    dobString = dobInput.value;
    eventString = eventInput.value;

    localStorage.setItem(EVENT_STORAGE_KEY + index, eventString)
    eventRes.textContent = recalculate(dobString, eventString);
  }

  function recalculate(dobString, eventString) {
    var dobParsed;
    var eventParsed;
    try {
      dobParsed = moment(dobString);
      eventParsed = moment(eventString);
    } catch {
      return 'Invalid Input';
    }

    if (!eventParsed.isValid() || !dobParsed.isValid()) {
      return 'Invalid Input';
    }

    var diff = eventParsed.clone().subtract(dobParsed).utc();
    var years = diff.year() - 1970 + (USE_ONE_INDEX ? 1 : 0);
    var days = diff.dayOfYear();
    var weeks = Math.floor(days / 7) + (USE_ONE_INDEX ? 1 : 0);

    return 'Event occured on Year: ' + years + ', Week: ' + weeks;
  }

  function setup() {
    dobDefaultValue = '2000-01-01';
    dobLocalStorage = localStorage.getItem(DOB_STORAGE_KEY);
    dobInput.value = dobLocalStorage || dobDefaultValue;

    createRow(0);
    num_rows = eventRows.childElementCount

    while (true) {
      var currentVal = localStorage.getItem(EVENT_STORAGE_KEY + num_rows);
      if (num_rows == 0 && currentVal == null) {
        currentVal = moment().format('YYYY-MM-DD');
      }
      if (currentVal == null) {
        return;
      }

      var row = eventRows.children.item(num_rows);
      row.getElementsByClassName('event_input').item(0).value = currentVal;
      createRow(num_rows + 1);
      num_rows = eventRows.childElementCount;
    }

    getValuesAndUpdateAll()
  }

  setup()
</script>
